define("static/scripts/index/position/position_list",["sea-modules/bootstrap/bootstrap","sea-modules/jquery/cookie/jquery.cookie","sea-modules/jquery/dialog/jquery.dialog","static/scripts/index/message","static/scripts/index/datatable","static/scripts/index/position/position_form"],function(o,t,e){e.exports=function(t){function e(o,t){$.get("/system/dataDictionary/findSchoolList?areaId="+o+"&token="+n,function(o){if("0000000"===o.rtnCode){var e=o.bizData,i=[],n=t?t.join("%"):"";i.push('<p><input name="school-checked-all" type="checkbox">&nbsp;全部</p>');for(var a=0,s=e.length;s>a;a++)i.push(n.indexOf(e[a].id)>-1?'<p><input name="school" checked="checked" type="checkbox" value="'+e[a].id+'">&nbsp;'+e[a].schoolName+"</p>":'<p><input name="school" type="checkbox" value="'+e[a].id+'">&nbsp;'+e[a].schoolName+"</p>");$("#school_checkbox").html(i.join("")),$('#school_checkbox input[name="school-checked-all"]').off("click"),$('#school_checkbox input[name="school-checked-all"]').on("click",function(){var o=$(this)[0].checked,t=document.getElementsByName("school");$.each(t,function(t,e){e.checked=o})}),$('#school_checkbox input[name="school"]').off("click"),$('#school_checkbox input[name="school"]').on("click",function(){var o=$(this)[0].checked;o||$('#school_checkbox input[name="school-checked-all"]').attr("checked",!1)})}})}function i(o,t){$.get("/system/dataDictionary/findAreaList?token="+n,function(i){if("0000000"===i.rtnCode){var n=[],a=o?o.join("%"):"";n.push('<option value="0">全部</option>');for(var s=0,c=i.bizData.length;c>s;s++)n.push(a.indexOf(i.bizData[s].id)>-1?'<option selected="selected" value="'+i.bizData[s].id+'">'+i.bizData[s].areaName+"</option>":'<option value="'+i.bizData[s].id+'">'+i.bizData[s].areaName+"</option>");$("#area").html(n.join("")),"0"!==$("#area").val()&&($("#manager_school").show(),e(o?o[0]:i.bizData[0].id,t))}})}o("sea-modules/bootstrap/bootstrap"),o("sea-modules/jquery/cookie/jquery.cookie"),o("sea-modules/jquery/dialog/jquery.dialog");var n=$.cookie("bizData"),a=o("static/scripts/index/message"),s=o("static/scripts/index/datatable"),c={constant:{COLUMN:[{data:"id"},{data:"postName",title:"岗位名称"},{data:"description",title:"岗位描述"}],COLUMN_DEFS:[{bVisible:!1,aTargets:[0]}]},initTable:function(){s.initTable({columns:this.constant.COLUMN,tableContentId:"menu_table_content",tableId:+new Date+"_table_body",columnDefs:this.constant.COLUMN_DEFS,sAjaxSource:"/system/post/queryPost?departmentCode="+t.id+"&token="+n})}};c.initTable();var r=s.dataTable,l=function(o,e,i,a){var s={postName:o[0]||"",description:o[1]||"",areaIds:o[2]||"",schoolIds:o[3]||""};i?s.id=i:s.departmentCode=t.id,a&&(s.postCode=a),$.ajax({type:"post",url:"/system/post/addOrEditPost?token="+n,contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:{postJson:JSON.stringify(s)},dataType:"json",success:function(o){e(o)},beforeSend:function(){},error:function(){}})},d=function(o){a({title:"温馨提示",msg:o.msg,type:"alert",clickHandle:function(){"0100014"===o.rtnCode&&(window.location.href="login.html")}})},p=function(){$("#add_position").dialog("destroy")},u={text:"取消","class":"btn btn-primary",click:p},f={add:function(t){$("#"+t).off("click"),$("#"+t).on("click",function(){r&&$.get("../tmpl/position/position_form.html",function(t){$("#add_position").dialog({title:"新增岗位",tmpl:t,onClose:p,render:function(){i(),$("#area").change(function(){var o=$(this).val();"0"!==o?($("#manager_school").show(),e(o)):($("#manager_school").hide(),$("#school_checkbox").html(""))})},buttons:[{text:"新增","class":"btn btn-primary",click:function(){var t=o("static/scripts/index/position/position_form");t.validate(function(o){l(o,function(o){"0000000"===o.rtnCode?(r.fnDraw(),p()):(p(),d(o))})})}},u]})})})},update:function(t){$("#"+t).off("click"),$("#"+t).on("click",function(){if(r){var t=s.fnGetSelected(r);if(0!==t.length){var a=r.fnGetData(t[0]);$.get("/system/post/getPost?id="+a.id+"&token="+n,function(t){"0000000"===t.rtnCode&&$.get("../tmpl/position/position_form.html",function(n){$("#add_position").dialog({title:"修改岗位",tmpl:n,onClose:p,render:function(){$("#position_name").val(t.bizData.postName),$("#position_describe").val(t.bizData.description),i(t.bizData.areaIds,t.bizData.schoolIds),$("#area").change(function(){var o=$(this).val();"0"!==o?($("#manager_school").show(),e(o,t.bizData.schoolIds)):($("#manager_school").hide(),$("#school_checkbox").html(""))})},buttons:[{text:"修改","class":"btn btn-primary",click:function(){var e=o("static/scripts/index/position/position_form");e.validate(function(o){l(o,function(o){"0000000"===o.rtnCode?(r.fnDraw(),p()):(p(),d(o))},a.id,t.bizData.postCode)})}},u]})})})}}})},"delete":function(o){$("#"+o).off("click"),$("#"+o).on("click",function(){if(r){var o=s.fnGetSelected(r);if(0!==o.length){var t=r.fnGetData(o[0]),e="确认删除岗位"+t.postName;a({title:"温馨提示",msg:e,type:"alert",clickHandle:function(){$.get("/system/post/delPost?id="+t.id+"&token="+n,function(o){"0000000"===o.rtnCode?r.fnDraw():d(o)})}})}}})},distributionRight:function(o){$("#"+o).off("click"),$("#"+o).on("click",function(){var o=s.selectedRecord();if(1!=o.length)return void d({msg:"每次只能选择一项分配权限"});var t=o[0].postCode;$("#role_radio").dialog({title:"分配权限",tmpl:'<div id="role_radio"></div>',onClose:function(){$("#role_radio").dialog("destroy")},render:function(){$.get("/system/role/getPostRoles?token="+n+"&postCode="+t,function(o){var t;"0000000"===o.rtnCode&&(t=o.bizData.roleCode),$.get("/system/role/queryComboxRoles?token="+n,function(o){if("0000000"===o.rtnCode){var e=o.bizData;if(!e)return $("#role_radio").dialog("destroy"),void d({msg:"请添加相关角色信息"});var i=[];for(var n in e){i.push('<div class="radio"><label>');var a="";n==t&&(a="checked"),i.push('<input type="radio" name="roleRadios" value="'+n+'" '+a+">"),i.push(e[n]),i.push("</label></div>")}i.push('<div class="radio" id="error_tip" style="color: #f00;"></div>'),$("#role_radio").html(i.join(""))}else $("#role_radio").dialog("destroy"),"0100010"===o.rtnCode&&d({msg:"请添加相关角色信息"})})})},buttons:[{text:"保存","class":"btn btn-primary",click:function(){var o=$("input[name='roleRadios']:checked").val();if(!o)return void $("#error_tip").html("请选择角色权限");var e={postCode:t,roleCode:o};$.ajax({type:"post",url:"/system/role/distributionRoles?token="+n,contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{rolePostJson:JSON.stringify(e)},dataType:"json",success:function(o){"0000000"===o.rtnCode?$("#role_radio").dialog("destroy"):($("#role_radio").dialog("destroy"),d(o))}})}},{text:"取消","class":"btn btn-primary",click:function(){$("#role_radio").dialog("destroy")}}]})})}};o.async(["static/scripts/index/renderResource"],function(o){o(f,n)})}});